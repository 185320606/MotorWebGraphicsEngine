define(["exports","./when-7ef6387a","./Check-ed6a1804","./Cartesian3-cb3509e0","./Ellipsoid-fc93f17d","./Matrix4-a5b26d08","./IntersectionTests-a6d581dd","./Plane-49ba40bc","./EllipsoidRhumbLine-24619cf9","./EllipsoidGeodesic-68966724"],(function(a,e,r,t,i,n,o,s,c,l){"use strict";var u={numberOfPoints:function(a,e,r){var i=t.Cartesian3.distance(a,e);return Math.ceil(i/r)},numberOfPointsRhumbLine:function(a,e,r){var t=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.ceil(Math.sqrt(t/(r*r)))}},h=new i.Cartographic;u.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),i=0;i<r;i++){var n=a[i];t[i]=e.cartesianToCartographic(n,h).height}return t};var f=new n.Matrix4,d=new t.Cartesian3,C=new t.Cartesian3,g=new s.Plane(t.Cartesian3.UNIT_X,0),p=new t.Cartesian3,v=new s.Plane(t.Cartesian3.UNIT_X,0),m=new t.Cartesian3,w=new t.Cartesian3,T=[];function P(a,e,r){var t,i=T;if(i.length=a,e===r){for(t=0;t<a;t++)i[t]=e;return i}var n=(r-e)/a;for(t=0;t<a;t++){var o=e+t*n;i[t]=o}return i}var y=new i.Cartographic,A=new i.Cartographic,E=new t.Cartesian3,b=new t.Cartesian3,S=new t.Cartesian3,R=new l.EllipsoidGeodesic,M=new c.EllipsoidRhumbLine;function D(a,e,r,i,n,o,s,c){var l=i.scaleToGeodeticSurface(a,b),h=i.scaleToGeodeticSurface(e,S),f=u.numberOfPoints(a,e,r),d=i.cartesianToCartographic(l,y),C=i.cartesianToCartographic(h,A),g=P(f,n,o);R.setEndPoints(d,C);var p=R.surfaceDistance/f,v=c;d.height=n;var m=i.cartographicToCartesian(d,E);t.Cartesian3.pack(m,s,v),v+=3;for(var w=1;w<f;w++){var T=R.interpolateUsingSurfaceDistance(w*p,A);T.height=g[w],m=i.cartographicToCartesian(T,E),t.Cartesian3.pack(m,s,v),v+=3}return v}function x(a,e,r,i,n,o,s,l){var h=i.scaleToGeodeticSurface(a,b),f=i.scaleToGeodeticSurface(e,S),d=i.cartesianToCartographic(h,y),C=i.cartesianToCartographic(f,A),g=u.numberOfPointsRhumbLine(d,C,r),p=P(g,n,o);M.ellipsoid.equals(i)||(M=new c.EllipsoidRhumbLine(void 0,void 0,i)),M.setEndPoints(d,C);var v=M.surfaceDistance/g,m=l;d.height=n;var w=i.cartographicToCartesian(d,E);t.Cartesian3.pack(w,s,m),m+=3;for(var T=1;T<g;T++){var R=M.interpolateUsingSurfaceDistance(T*v,A);R.height=p[T],w=i.cartographicToCartesian(R,E),t.Cartesian3.pack(w,s,m),m+=3}return m}u.wrapLongitude=function(a,r){var i=[],c=[];if(e.defined(a)&&a.length>0){r=e.defaultValue(r,n.Matrix4.IDENTITY);var l=n.Matrix4.inverseTransformation(r,f),u=n.Matrix4.multiplyByPoint(l,t.Cartesian3.ZERO,d),h=t.Cartesian3.normalize(n.Matrix4.multiplyByPointAsVector(l,t.Cartesian3.UNIT_Y,C),C),T=s.Plane.fromPointNormal(u,h,g),P=t.Cartesian3.normalize(n.Matrix4.multiplyByPointAsVector(l,t.Cartesian3.UNIT_X,p),p),y=s.Plane.fromPointNormal(u,P,v),A=1;i.push(t.Cartesian3.clone(a[0]));for(var E=i[0],b=a.length,S=1;S<b;++S){var R=a[S];if(s.Plane.getPointDistance(y,E)<0||s.Plane.getPointDistance(y,R)<0){var M=o.IntersectionTests.lineSegmentPlane(E,R,T,m);if(e.defined(M)){var D=t.Cartesian3.multiplyByScalar(h,5e-9,w);s.Plane.getPointDistance(T,E)<0&&t.Cartesian3.negate(D,D),i.push(t.Cartesian3.add(M,D,new t.Cartesian3)),c.push(A+1),t.Cartesian3.negate(D,D),i.push(t.Cartesian3.add(M,D,new t.Cartesian3)),A=1}}i.push(t.Cartesian3.clone(a[S])),A++,E=R}c.push(A)}return{positions:i,lengths:c}},u.generateArc=function(a){e.defined(a)||(a={});var r=a.positions,n=r.length,o=e.defaultValue(a.ellipsoid,i.Ellipsoid.WGS84),s=e.defaultValue(a.height,0),c=Array.isArray(s);if(n<1)return[];if(1===n){var l=o.scaleToGeodeticSurface(r[0],b);if(0!==(s=c?s[0]:s)){var h=o.geodeticSurfaceNormal(l,E);t.Cartesian3.multiplyByScalar(h,s,h),t.Cartesian3.add(l,h,l)}return[l.x,l.y,l.z]}var f=a.minDistance;if(!e.defined(f)){var d=e.defaultValue(a.granularity,t.CesiumMath.RADIANS_PER_DEGREE);f=t.CesiumMath.chordLength(d,o.maximumRadius)}var C,g=0;for(C=0;C<n-1;C++)g+=u.numberOfPoints(r[C],r[C+1],f);var p=3*(g+1),v=new Array(p),m=0;for(C=0;C<n-1;C++){m=D(r[C],r[C+1],f,o,c?s[C]:s,c?s[C+1]:s,v,m)}T.length=0;var w=r[n-1],P=o.cartesianToCartographic(w,y);P.height=c?s[n-1]:s;var A=o.cartographicToCartesian(P,E);return t.Cartesian3.pack(A,v,p-3),v};var G=new i.Cartographic,N=new i.Cartographic;u.generateRhumbArc=function(a){e.defined(a)||(a={});var r=a.positions,n=r.length,o=e.defaultValue(a.ellipsoid,i.Ellipsoid.WGS84),s=e.defaultValue(a.height,0),c=Array.isArray(s);if(n<1)return[];if(1===n){var l=o.scaleToGeodeticSurface(r[0],b);if(0!==(s=c?s[0]:s)){var h=o.geodeticSurfaceNormal(l,E);t.Cartesian3.multiplyByScalar(h,s,h),t.Cartesian3.add(l,h,l)}return[l.x,l.y,l.z]}var f,d,C=e.defaultValue(a.granularity,t.CesiumMath.RADIANS_PER_DEGREE),g=0,p=o.cartesianToCartographic(r[0],G);for(f=0;f<n-1;f++)d=o.cartesianToCartographic(r[f+1],N),g+=u.numberOfPointsRhumbLine(p,d,C),p=i.Cartographic.clone(d,G);var v=3*(g+1),m=new Array(v),w=0;for(f=0;f<n-1;f++){w=x(r[f],r[f+1],C,o,c?s[f]:s,c?s[f+1]:s,m,w)}T.length=0;var P=r[n-1],A=o.cartesianToCartographic(P,y);A.height=c?s[n-1]:s;var S=o.cartographicToCartesian(A,E);return t.Cartesian3.pack(S,m,v-3),m},u.generateCartesianArc=function(a){for(var e=u.generateArc(a),r=e.length/3,i=new Array(r),n=0;n<r;n++)i[n]=t.Cartesian3.unpack(e,3*n);return i},u.generateCartesianRhumbArc=function(a){for(var e=u.generateRhumbArc(a),r=e.length/3,i=new Array(r),n=0;n<r;n++)i[n]=t.Cartesian3.unpack(e,3*n);return i},a.PolylinePipeline=u}));

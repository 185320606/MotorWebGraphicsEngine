define(["./when-7ef6387a","./Check-ed6a1804","./Math-55f9392d","./Ellipsoid-911f8bc2","./Transforms-d8f9dcbd","./RuntimeError-5b606d78","./Cartesian2-ff47d58f","./WebGLConstants-30fc6f5c","./ComponentDatatype-a863af81","./GeometryAttribute-45a4c7c8","./GeometryAttributes-cb18da36","./AttributeCompression-31bd05f3","./GeometryPipeline-bccb2d54","./EncodedCartesian3-fe5f78b3","./IndexDatatype-891b5845","./IntersectionTests-c6e3245b","./Plane-02009bbb","./VertexFormat-d75df48f","./GeometryInstance-ca11f8fa","./arrayRemoveDuplicates-8221727f","./BoundingRectangle-335c7812","./EllipsoidTangentPlane-dfb29add","./OrientedBoundingBox-d4914ac2","./CoplanarPolygonGeometryLibrary-eb9019ed","./ArcType-2ee8dfbb","./EllipsoidRhumbLine-bd68e2e2","./PolygonPipeline-41e201d5","./PolygonGeometryLibrary-0c038e3c"],(function(e,t,a,n,r,o,i,s,l,p,c,y,d,u,m,g,f,b,h,v,C,x,P,w,A,F,G,L){"use strict";var E=new n.Cartesian3,k=new C.BoundingRectangle,T=new i.Cartesian2,D=new i.Cartesian2,_=new n.Cartesian3,V=new n.Cartesian3,R=new n.Cartesian3,I=new n.Cartesian3,M=new n.Cartesian3,H=new n.Cartesian3,B=new r.Quaternion,O=new r.Matrix3,z=new r.Matrix3,S=new n.Cartesian3;function N(e,t,o,s,y,d,u,g){var f=e.positions,b=G.PolygonPipeline.triangulate(e.positions2D,e.holes);b.length<3&&(b=[0,1,2]);var h=m.IndexDatatype.createTypedArray(f.length,b.length);h.set(b);var v=O;if(0!==s){var C=r.Quaternion.fromAxisAngle(d,s,B);if(v=r.Matrix3.fromQuaternion(C,v),t.tangent||t.bitangent){C=r.Quaternion.fromAxisAngle(d,-s,B);var x=r.Matrix3.fromQuaternion(C,z);u=n.Cartesian3.normalize(r.Matrix3.multiplyByVector(x,u,u),u),t.bitangent&&(g=n.Cartesian3.normalize(n.Cartesian3.cross(d,u,g),g))}}else v=r.Matrix3.clone(r.Matrix3.IDENTITY,v);var P=D;t.st&&(P.x=o.x,P.y=o.y);for(var w=f.length,A=3*w,F=new Float64Array(A),L=t.normal?new Float32Array(A):void 0,k=t.tangent?new Float32Array(A):void 0,_=t.bitangent?new Float32Array(A):void 0,V=t.st?new Float32Array(2*w):void 0,R=0,I=0,M=0,H=0,S=0,N=0;N<w;N++){var Q=f[N];if(F[R++]=Q.x,F[R++]=Q.y,F[R++]=Q.z,t.st){var j=y(r.Matrix3.multiplyByVector(v,Q,E),T);i.Cartesian2.subtract(j,P,j);var U=a.CesiumMath.clamp(j.x/o.width,0,1),Y=a.CesiumMath.clamp(j.y/o.height,0,1);V[S++]=U,V[S++]=Y}t.normal&&(L[I++]=d.x,L[I++]=d.y,L[I++]=d.z),t.tangent&&(k[H++]=u.x,k[H++]=u.y,k[H++]=u.z),t.bitangent&&(_[M++]=g.x,_[M++]=g.y,_[M++]=g.z)}var q=new c.GeometryAttributes;return t.position&&(q.position=new p.GeometryAttribute({componentDatatype:l.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:F})),t.normal&&(q.normal=new p.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),t.tangent&&(q.tangent=new p.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),t.bitangent&&(q.bitangent=new p.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_})),t.st&&(q.st=new p.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:V})),new p.Geometry({attributes:q,indices:h,primitiveType:p.PrimitiveType.TRIANGLES})}function Q(a){var r=(a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT)).polygonHierarchy;t.Check.defined("options.polygonHierarchy",r);var o=e.defaultValue(a.vertexFormat,b.VertexFormat.DEFAULT);this._vertexFormat=b.VertexFormat.clone(o),this._polygonHierarchy=r,this._stRotation=e.defaultValue(a.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(e.defaultValue(a.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=L.PolygonGeometryLibrary.computeHierarchyPackedLength(r)+b.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}Q.fromPositions=function(a){return a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT),t.Check.defined("options.positions",a.positions),new Q({polygonHierarchy:{positions:a.positions},vertexFormat:a.vertexFormat,stRotation:a.stRotation,ellipsoid:a.ellipsoid})},Q.pack=function(a,r,o){return t.Check.typeOf.object("value",a),t.Check.defined("array",r),o=e.defaultValue(o,0),o=L.PolygonGeometryLibrary.packPolygonHierarchy(a._polygonHierarchy,r,o),n.Ellipsoid.pack(a._ellipsoid,r,o),o+=n.Ellipsoid.packedLength,b.VertexFormat.pack(a._vertexFormat,r,o),o+=b.VertexFormat.packedLength,r[o++]=a._stRotation,r[o]=a.packedLength,r};var j=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),U=new b.VertexFormat,Y={polygonHierarchy:{}};return Q.unpack=function(a,r,o){t.Check.defined("array",a),r=e.defaultValue(r,0);var i=L.PolygonGeometryLibrary.unpackPolygonHierarchy(a,r);r=i.startingIndex,delete i.startingIndex;var s=n.Ellipsoid.unpack(a,r,j);r+=n.Ellipsoid.packedLength;var l=b.VertexFormat.unpack(a,r,U);r+=b.VertexFormat.packedLength;var p=a[r++],c=a[r];return e.defined(o)||(o=new Q(Y)),o._polygonHierarchy=i,o._ellipsoid=n.Ellipsoid.clone(s,o._ellipsoid),o._vertexFormat=b.VertexFormat.clone(l,o._vertexFormat),o._stRotation=p,o.packedLength=c,o},Q.createGeometry=function(e){var t=e._vertexFormat,o=e._polygonHierarchy,i=e._stRotation,s=o.positions;if(!((s=v.arrayRemoveDuplicates(s,n.Cartesian3.equalsEpsilon,!0)).length<3)){var l=_,c=V,y=R,u=M,g=H;if(w.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(s,I,u,g)){if(l=n.Cartesian3.cross(u,g,l),l=n.Cartesian3.normalize(l,l),!n.Cartesian3.equalsEpsilon(I,n.Cartesian3.ZERO,a.CesiumMath.EPSILON6)){var f=e._ellipsoid.geodeticSurfaceNormal(I,S);n.Cartesian3.dot(l,f)<0&&(l=n.Cartesian3.negate(l,l),u=n.Cartesian3.negate(u,u))}var b=w.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(I,u,g),C=w.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(I,u,g);t.tangent&&(c=n.Cartesian3.clone(u,c)),t.bitangent&&(y=n.Cartesian3.clone(g,y));var x=L.PolygonGeometryLibrary.polygonsFromHierarchy(o,b,!1),P=x.hierarchy,A=x.polygons;if(0!==P.length){s=P[0].outerRing;for(var F=r.BoundingSphere.fromPoints(s),G=L.PolygonGeometryLibrary.computeBoundingRectangle(l,C,s,i,k),E=[],T=0;T<A.length;T++){var D=new h.GeometryInstance({geometry:N(A[T],t,G,i,C,l,c,y)});E.push(D)}var B=d.GeometryPipeline.combineInstances(E)[0];B.attributes.position.values=new Float64Array(B.attributes.position.values),B.indices=m.IndexDatatype.createTypedArray(B.attributes.position.values.length/3,B.indices);var O=B.attributes;return t.position||delete O.position,new p.Geometry({attributes:O,indices:B.indices,primitiveType:B.primitiveType,boundingSphere:F})}}}},function(t,a){return e.defined(a)&&(t=Q.unpack(t,a)),Q.createGeometry(t)}}));
//# sourceMappingURL=createCoplanarPolygonGeometry.js.map

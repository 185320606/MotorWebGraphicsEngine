define(["exports","./Cartesian3-cb3509e0","./Ellipsoid-fc93f17d","./Transforms-fe3a4031","./Matrix4-a5b26d08","./Cartesian2-7da3df11","./EllipsoidTangentPlane-e5201ea2","./PolylinePipeline-7dda0eb1"],(function(a,e,r,n,t,i,s,o){"use strict";var l=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),C=[new e.Cartesian3,new e.Cartesian3],c=new e.Cartesian3,u=new e.Cartesian3,y=new e.Cartesian3,d=new e.Cartesian3,m=new e.Cartesian3,f=new e.Cartesian3,p=new e.Cartesian3,g=new e.Cartesian3,w=new e.Cartesian3,h=new e.Cartesian3,v=new e.Cartesian3,x={},P=new r.Cartographic;function E(a,r,n,t){var i,s=a[0],o=a[1],l=e.Cartesian3.angleBetween(s,o),C=Math.ceil(l/t),c=new Array(C);if(r===n){for(i=0;i<C;i++)c[i]=r;return c.push(n),c}var u=(n-r)/C;for(i=1;i<C;i++){var y=r+i*u;c[i]=y}return c[0]=r,c.push(n),c}var M=new e.Cartesian3,T=new e.Cartesian3;var B=new e.Cartesian3(-1,0,0),z=new t.Matrix4,S=new t.Matrix4,b=new t.Matrix3,A=t.Matrix3.IDENTITY.clone(),D=new e.Cartesian3,O=new t.Cartesian4,N=new e.Cartesian3;function V(a,r,o,l,C,c,u,y){var d=D,m=O;z=n.Transforms.eastNorthUpToFixedFrame(a,C,z),d=t.Matrix4.multiplyByPointAsVector(z,B,d);var f=function(a,r,n,t){var o=new s.EllipsoidTangentPlane(n,t),l=o.projectPointOntoPlane(e.Cartesian3.add(n,a,M),M),C=o.projectPointOntoPlane(e.Cartesian3.add(n,r,T),T),c=i.Cartesian2.angleBetween(l,C);return C.x*l.y-C.y*l.x>=0?-c:c}(d=e.Cartesian3.normalize(d,d),r,a,C);b=t.Matrix3.fromRotationZ(f,b),N.z=c,z=t.Matrix4.multiplyTransformation(z,t.Matrix4.fromRotationTranslation(b,N,S),z);var p=A;p[0]=u;for(var g=0;g<y;g++)for(var w=0;w<o.length;w+=3)m=e.Cartesian3.fromArray(o,w,m),m=t.Matrix3.multiplyByVector(p,m,m),m=t.Matrix4.multiplyByPoint(z,m,m),l.push(m.x,m.y,m.z);return l}var G=new e.Cartesian3;function R(a,r,n,t,i,s,o){for(var l=0;l<a.length;l+=3){t=V(e.Cartesian3.fromArray(a,l,G),r,n,t,i,s[l/3],o,1)}return t}function I(a,e){for(var r=a.length,n=new Array(3*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=0;o<r;o++)n[t++]=a[o].x-i,n[t++]=0,n[t++]=a[o].y-s;return n}var L=new n.Quaternion,j=new e.Cartesian3,Q=new t.Matrix3;function F(a,r,i,s,o,C,c,u,y,d){var m,f,p=e.Cartesian3.angleBetween(e.Cartesian3.subtract(r,a,h),e.Cartesian3.subtract(i,a,v)),g=s===l.BEVELED?0:Math.ceil(p/e.CesiumMath.toRadians(5));if(m=o?t.Matrix3.fromQuaternion(n.Quaternion.fromAxisAngle(e.Cartesian3.negate(a,h),p/(g+1),L),Q):t.Matrix3.fromQuaternion(n.Quaternion.fromAxisAngle(a,p/(g+1),L),Q),r=e.Cartesian3.clone(r,j),g>0)for(var w=d?2:1,x=0;x<g;x++)r=t.Matrix3.multiplyByVector(m,r,r),f=e.Cartesian3.subtract(r,a,h),f=e.Cartesian3.normalize(f,f),o||(f=e.Cartesian3.negate(f,f)),c=V(C.scaleToGeodeticSurface(r,v),f,u,c,C,y,1,w);else f=e.Cartesian3.subtract(r,a,h),f=e.Cartesian3.normalize(f,f),o||(f=e.Cartesian3.negate(f,f)),c=V(C.scaleToGeodeticSurface(r,v),f,u,c,C,y,1,1),i=e.Cartesian3.clone(i,j),f=e.Cartesian3.subtract(i,a,h),f=e.Cartesian3.normalize(f,f),o||(f=e.Cartesian3.negate(f,f)),c=V(C.scaleToGeodeticSurface(i,v),f,u,c,C,y,1,1);return c}x.removeDuplicatesFromShape=function(a){for(var e=a.length,r=[],n=e-1,t=0;t<e;n=t++){var s=a[n],o=a[t];i.Cartesian2.equals(s,o)||r.push(o)}return r},x.angleIsGreaterThanPi=function(a,r,n,t){var i=new s.EllipsoidTangentPlane(n,t),o=i.projectPointOntoPlane(e.Cartesian3.add(n,a,M),M),l=i.projectPointOntoPlane(e.Cartesian3.add(n,r,T),T);return l.x*o.y-l.y*o.x>=0};var U=new e.Cartesian3,_=new e.Cartesian3;x.computePositions=function(a,r,n,t,i){var s=t._ellipsoid,v=function(a,e){for(var r=new Array(a.length),n=0;n<a.length;n++){var t=a[n];P=e.cartesianToCartographic(t,P),r[n]=P.height,a[n]=e.scaleToGeodeticSurface(t,t)}return r}(a,s),M=t._granularity,T=t._cornerType,B=i?function(a,e){var r=a.length,n=new Array(6*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=a[0];n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s;for(var l=1;l<r;l++){var C=(o=a[l]).x-i,c=o.y-s;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return o=a[0],n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s,n}(r,n):I(r,n),z=i?I(r,n):void 0,S=n.height/2,b=n.width/2,A=a.length,D=[],O=i?[]:void 0,N=c,G=u,L=y,j=d,Q=m,q=f,Y=p,Z=g,k=w,H=a[0],J=a[1];j=s.geodeticSurfaceNormal(H,j),N=e.Cartesian3.subtract(J,H,N),N=e.Cartesian3.normalize(N,N),Z=e.Cartesian3.cross(j,N,Z),Z=e.Cartesian3.normalize(Z,Z);var K,W=v[0],X=v[1];i&&(O=V(H,Z,z,O,s,W+S,1,1)),k=e.Cartesian3.clone(H,k),H=J,G=e.Cartesian3.negate(N,G);for(var $=1;$<A-1;$++){var aa=i?2:1;J=a[$+1],N=e.Cartesian3.subtract(J,H,N),N=e.Cartesian3.normalize(N,N),L=e.Cartesian3.add(N,G,L),L=e.Cartesian3.normalize(L,L),j=s.geodeticSurfaceNormal(H,j);var ea=e.Cartesian3.multiplyByScalar(j,e.Cartesian3.dot(N,j),U);e.Cartesian3.subtract(N,ea,ea),e.Cartesian3.normalize(ea,ea);var ra=e.Cartesian3.multiplyByScalar(j,e.Cartesian3.dot(G,j),_);if(e.Cartesian3.subtract(G,ra,ra),e.Cartesian3.normalize(ra,ra),!e.CesiumMath.equalsEpsilon(Math.abs(e.Cartesian3.dot(ea,ra)),1,e.CesiumMath.EPSILON7)){L=e.Cartesian3.cross(L,j,L),L=e.Cartesian3.cross(j,L,L),L=e.Cartesian3.normalize(L,L);var na=1/Math.max(.25,e.Cartesian3.magnitude(e.Cartesian3.cross(L,G,h))),ta=x.angleIsGreaterThanPi(N,G,H,s);ta?(Q=e.Cartesian3.add(H,e.Cartesian3.multiplyByScalar(L,na*b,L),Q),q=e.Cartesian3.add(Q,e.Cartesian3.multiplyByScalar(Z,b,q),q),C[0]=e.Cartesian3.clone(k,C[0]),C[1]=e.Cartesian3.clone(q,C[1]),K=E(C,W+S,X+S,M),D=R(o.PolylinePipeline.generateArc({positions:C,granularity:M,ellipsoid:s}),Z,B,D,s,K,1),Z=e.Cartesian3.cross(j,N,Z),Z=e.Cartesian3.normalize(Z,Z),Y=e.Cartesian3.add(Q,e.Cartesian3.multiplyByScalar(Z,b,Y),Y),T===l.ROUNDED||T===l.BEVELED?F(Q,q,Y,T,ta,s,D,B,X+S,i):D=V(H,L=e.Cartesian3.negate(L,L),B,D,s,X+S,na,aa),k=e.Cartesian3.clone(Y,k)):(Q=e.Cartesian3.add(H,e.Cartesian3.multiplyByScalar(L,na*b,L),Q),q=e.Cartesian3.add(Q,e.Cartesian3.multiplyByScalar(Z,-b,q),q),C[0]=e.Cartesian3.clone(k,C[0]),C[1]=e.Cartesian3.clone(q,C[1]),K=E(C,W+S,X+S,M),D=R(o.PolylinePipeline.generateArc({positions:C,granularity:M,ellipsoid:s}),Z,B,D,s,K,1),Z=e.Cartesian3.cross(j,N,Z),Z=e.Cartesian3.normalize(Z,Z),Y=e.Cartesian3.add(Q,e.Cartesian3.multiplyByScalar(Z,-b,Y),Y),T===l.ROUNDED||T===l.BEVELED?F(Q,q,Y,T,ta,s,D,B,X+S,i):D=V(H,L,B,D,s,X+S,na,aa),k=e.Cartesian3.clone(Y,k)),G=e.Cartesian3.negate(N,G)}else D=V(k,Z,B,D,s,W+S,1,1),k=H;W=X,X=v[$+1],H=J}C[0]=e.Cartesian3.clone(k,C[0]),C[1]=e.Cartesian3.clone(H,C[1]),K=E(C,W+S,X+S,M),D=R(o.PolylinePipeline.generateArc({positions:C,granularity:M,ellipsoid:s}),Z,B,D,s,K,1),i&&(O=V(H,Z,z,O,s,X+S,1,1)),A=D.length;var ia=i?A+O.length:A,sa=new Float64Array(ia);return sa.set(D),i&&sa.set(O,A),sa},a.CornerType=l,a.PolylineVolumeGeometryLibrary=x}));

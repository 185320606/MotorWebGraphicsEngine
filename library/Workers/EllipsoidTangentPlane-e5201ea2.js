define(["exports","./when-7ef6387a","./Check-ed6a1804","./Cartesian3-cb3509e0","./Ellipsoid-fc93f17d","./Transforms-fe3a4031","./Matrix4-a5b26d08","./Cartesian2-7da3df11","./IntersectionTests-a6d581dd","./Plane-49ba40bc"],(function(e,n,t,i,a,r,s,o,m,l){"use strict";function c(e,t,a){this.minimum=i.Cartesian3.clone(n.defaultValue(e,i.Cartesian3.ZERO)),this.maximum=i.Cartesian3.clone(n.defaultValue(t,i.Cartesian3.ZERO)),a=n.defined(a)?i.Cartesian3.clone(a):i.Cartesian3.midpoint(this.minimum,this.maximum,new i.Cartesian3),this.center=a}c.fromPoints=function(e,t){if(n.defined(t)||(t=new c),!n.defined(e)||0===e.length)return t.minimum=i.Cartesian3.clone(i.Cartesian3.ZERO,t.minimum),t.maximum=i.Cartesian3.clone(i.Cartesian3.ZERO,t.maximum),t.center=i.Cartesian3.clone(i.Cartesian3.ZERO,t.center),t;for(var a=e[0].x,r=e[0].y,s=e[0].z,o=e[0].x,m=e[0].y,l=e[0].z,u=e.length,d=1;d<u;d++){var f=e[d],h=f.x,C=f.y,p=f.z;a=Math.min(h,a),o=Math.max(h,o),r=Math.min(C,r),m=Math.max(C,m),s=Math.min(p,s),l=Math.max(p,l)}var x=t.minimum;x.x=a,x.y=r,x.z=s;var y=t.maximum;return y.x=o,y.y=m,y.z=l,t.center=i.Cartesian3.midpoint(x,y,t.center),t},c.clone=function(e,t){if(n.defined(e))return n.defined(t)?(t.minimum=i.Cartesian3.clone(e.minimum,t.minimum),t.maximum=i.Cartesian3.clone(e.maximum,t.maximum),t.center=i.Cartesian3.clone(e.center,t.center),t):new c(e.minimum,e.maximum,e.center)},c.equals=function(e,t){return e===t||n.defined(e)&&n.defined(t)&&i.Cartesian3.equals(e.center,t.center)&&i.Cartesian3.equals(e.minimum,t.minimum)&&i.Cartesian3.equals(e.maximum,t.maximum)};var u=new i.Cartesian3;c.intersectPlane=function(e,n){u=i.Cartesian3.subtract(e.maximum,e.minimum,u);var t=i.Cartesian3.multiplyByScalar(u,.5,u),a=n.normal,s=t.x*Math.abs(a.x)+t.y*Math.abs(a.y)+t.z*Math.abs(a.z),o=i.Cartesian3.dot(e.center,a)+n.distance;return o-s>0?r.Intersect.INSIDE:o+s<0?r.Intersect.OUTSIDE:r.Intersect.INTERSECTING},c.prototype.clone=function(e){return c.clone(this,e)},c.prototype.intersectPlane=function(e){return c.intersectPlane(this,e)},c.prototype.equals=function(e){return c.equals(this,e)};var d=new s.Cartesian4;function f(e,t){e=(t=n.defaultValue(t,a.Ellipsoid.WGS84)).scaleToGeodeticSurface(e);var o=r.Transforms.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=i.Cartesian3.fromCartesian4(s.Matrix4.getColumn(o,0,d)),this._yAxis=i.Cartesian3.fromCartesian4(s.Matrix4.getColumn(o,1,d));var m=i.Cartesian3.fromCartesian4(s.Matrix4.getColumn(o,2,d));this._plane=l.Plane.fromPointNormal(e,m)}Object.defineProperties(f.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var h=new c;f.fromPoints=function(e,n){return new f(c.fromPoints(e,h).center,n)};var C=new m.Ray,p=new i.Cartesian3;f.prototype.projectPointOntoPlane=function(e,t){var a=C;a.origin=e,i.Cartesian3.normalize(e,a.direction);var r=m.IntersectionTests.rayPlane(a,this._plane,p);if(n.defined(r)||(i.Cartesian3.negate(a.direction,a.direction),r=m.IntersectionTests.rayPlane(a,this._plane,p)),n.defined(r)){var s=i.Cartesian3.subtract(r,this._origin,r),l=i.Cartesian3.dot(this._xAxis,s),c=i.Cartesian3.dot(this._yAxis,s);return n.defined(t)?(t.x=l,t.y=c,t):new o.Cartesian2(l,c)}},f.prototype.projectPointsOntoPlane=function(e,t){n.defined(t)||(t=[]);for(var i=0,a=e.length,r=0;r<a;r++){var s=this.projectPointOntoPlane(e[r],t[i]);n.defined(s)&&(t[i]=s,i++)}return t.length=i,t},f.prototype.projectPointToNearestOnPlane=function(e,t){n.defined(t)||(t=new o.Cartesian2);var a=C;a.origin=e,i.Cartesian3.clone(this._plane.normal,a.direction);var r=m.IntersectionTests.rayPlane(a,this._plane,p);n.defined(r)||(i.Cartesian3.negate(a.direction,a.direction),r=m.IntersectionTests.rayPlane(a,this._plane,p));var s=i.Cartesian3.subtract(r,this._origin,r),l=i.Cartesian3.dot(this._xAxis,s),c=i.Cartesian3.dot(this._yAxis,s);return t.x=l,t.y=c,t},f.prototype.projectPointsToNearestOnPlane=function(e,t){n.defined(t)||(t=[]);var i=e.length;t.length=i;for(var a=0;a<i;a++)t[a]=this.projectPointToNearestOnPlane(e[a],t[a]);return t};var x=new i.Cartesian3;f.prototype.projectPointOntoEllipsoid=function(e,t){n.defined(t)||(t=new i.Cartesian3);var a=this._ellipsoid,r=this._origin,s=this._xAxis,o=this._yAxis,m=x;return i.Cartesian3.multiplyByScalar(s,e.x,m),t=i.Cartesian3.add(r,m,t),i.Cartesian3.multiplyByScalar(o,e.y,m),i.Cartesian3.add(t,m,t),a.scaleToGeocentricSurface(t,t),t},f.prototype.projectPointsOntoEllipsoid=function(e,t){var i=e.length;n.defined(t)?t.length=i:t=new Array(i);for(var a=0;a<i;++a)t[a]=this.projectPointOntoEllipsoid(e[a],t[a]);return t},e.AxisAlignedBoundingBox=c,e.EllipsoidTangentPlane=f}));

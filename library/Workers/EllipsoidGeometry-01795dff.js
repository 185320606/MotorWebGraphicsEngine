define(["exports","./when-7ef6387a","./Check-ed6a1804","./Cartesian3-cb3509e0","./Ellipsoid-fc93f17d","./Transforms-fe3a4031","./Cartesian2-7da3df11","./ComponentDatatype-3593b1c2","./GeometryAttribute-e8505198","./PrimitiveType-4c1d698a","./GeometryAttributes-cb18da36","./IndexDatatype-030efa67","./GeometryOffsetAttribute-e4fca9ed","./VertexFormat-c6d7c90a"],(function(t,e,a,i,r,n,o,m,s,u,l,f,c,d){"use strict";var C=new i.Cartesian3,p=new i.Cartesian3,y=new i.Cartesian3,_=new i.Cartesian3,v=new i.Cartesian3,h=new i.Cartesian3(1,1,1),A=Math.cos,x=Math.sin;function b(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT);var a=e.defaultValue(t.radii,h),r=e.defaultValue(t.innerRadii,a),n=e.defaultValue(t.minimumClock,0),o=e.defaultValue(t.maximumClock,i.CesiumMath.TWO_PI),m=e.defaultValue(t.minimumCone,0),s=e.defaultValue(t.maximumCone,i.CesiumMath.PI),u=Math.round(e.defaultValue(t.stackPartitions,64)),l=Math.round(e.defaultValue(t.slicePartitions,64)),f=e.defaultValue(t.vertexFormat,d.VertexFormat.DEFAULT);this._radii=i.Cartesian3.clone(a),this._innerRadii=i.Cartesian3.clone(r),this._minimumClock=n,this._maximumClock=o,this._minimumCone=m,this._maximumCone=s,this._stackPartitions=u,this._slicePartitions=l,this._vertexFormat=d.VertexFormat.clone(f),this._offsetAttribute=t.offsetAttribute,this._workerName="createEllipsoidGeometry"}b.packedLength=2*i.Cartesian3.packedLength+d.VertexFormat.packedLength+7,b.pack=function(t,a,r){return r=e.defaultValue(r,0),i.Cartesian3.pack(t._radii,a,r),r+=i.Cartesian3.packedLength,i.Cartesian3.pack(t._innerRadii,a,r),r+=i.Cartesian3.packedLength,d.VertexFormat.pack(t._vertexFormat,a,r),r+=d.VertexFormat.packedLength,a[r++]=t._minimumClock,a[r++]=t._maximumClock,a[r++]=t._minimumCone,a[r++]=t._maximumCone,a[r++]=t._stackPartitions,a[r++]=t._slicePartitions,a[r]=e.defaultValue(t._offsetAttribute,-1),a};var k,w=new i.Cartesian3,F=new i.Cartesian3,P=new d.VertexFormat,g={radii:w,innerRadii:F,vertexFormat:P,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};b.unpack=function(t,a,r){a=e.defaultValue(a,0);var n=i.Cartesian3.unpack(t,a,w);a+=i.Cartesian3.packedLength;var o=i.Cartesian3.unpack(t,a,F);a+=i.Cartesian3.packedLength;var m=d.VertexFormat.unpack(t,a,P);a+=d.VertexFormat.packedLength;var s=t[a++],u=t[a++],l=t[a++],f=t[a++],c=t[a++],C=t[a++],p=t[a];return e.defined(r)?(r._radii=i.Cartesian3.clone(n,r._radii),r._innerRadii=i.Cartesian3.clone(o,r._innerRadii),r._vertexFormat=d.VertexFormat.clone(m,r._vertexFormat),r._minimumClock=s,r._maximumClock=u,r._minimumCone=l,r._maximumCone=f,r._stackPartitions=c,r._slicePartitions=C,r._offsetAttribute=-1===p?void 0:p,r):(g.minimumClock=s,g.maximumClock=u,g.minimumCone=l,g.maximumCone=f,g.stackPartitions=c,g.slicePartitions=C,g.offsetAttribute=-1===p?void 0:p,new b(g))},b.createGeometry=function(t){var a=t._radii;if(!(a.x<=0||a.y<=0||a.z<=0)){var d=t._innerRadii;if(!(d.x<=0||d.y<=0||d.z<=0)){var h,b,k=t._minimumClock,w=t._maximumClock,F=t._minimumCone,P=t._maximumCone,g=t._vertexFormat,V=t._slicePartitions+1,T=t._stackPartitions+1;(V=Math.round(V*Math.abs(w-k)/i.CesiumMath.TWO_PI))<2&&(V=2),(T=Math.round(T*Math.abs(P-F)/i.CesiumMath.PI))<2&&(T=2);var M=0,D=[F],G=[k];for(h=0;h<T;h++)D.push(F+h*(P-F)/(T-1));for(D.push(P),b=0;b<V;b++)G.push(k+b*(w-k)/(V-1));G.push(w);var L=D.length,O=G.length,I=0,E=1,z=d.x!==a.x||d.y!==a.y||d.z!==a.z,N=!1,R=!1,U=!1;z&&(E=2,F>0&&(N=!0,I+=V-1),P<Math.PI&&(R=!0,I+=V-1),(w-k)%i.CesiumMath.TWO_PI?(U=!0,I+=2*(T-1)+1):I+=1);var S=O*L*E,B=new Float64Array(3*S),W=c.arrayFill(new Array(S),!1),Y=c.arrayFill(new Array(S),!1),J=V*T*E,X=6*(J+I+1-(V+T)*E),Z=f.IndexDatatype.createTypedArray(J,X),j=g.normal?new Float32Array(3*S):void 0,q=g.tangent?new Float32Array(3*S):void 0,H=g.bitangent?new Float32Array(3*S):void 0,K=g.st?new Float32Array(2*S):void 0,Q=new Array(L),$=new Array(L);for(h=0;h<L;h++)Q[h]=x(D[h]),$[h]=A(D[h]);var tt=new Array(O),et=new Array(O);for(b=0;b<O;b++)et[b]=A(G[b]),tt[b]=x(G[b]);for(h=0;h<L;h++)for(b=0;b<O;b++)B[M++]=a.x*Q[h]*et[b],B[M++]=a.y*Q[h]*tt[b],B[M++]=a.z*$[h];var at,it,rt,nt,ot=S/2;if(z)for(h=0;h<L;h++)for(b=0;b<O;b++)B[M++]=d.x*Q[h]*et[b],B[M++]=d.y*Q[h]*tt[b],B[M++]=d.z*$[h],W[ot]=!0,h>0&&h!==L-1&&0!==b&&b!==O-1&&(Y[ot]=!0),ot++;for(M=0,h=1;h<L-2;h++)for(at=h*O,it=(h+1)*O,b=1;b<O-2;b++)Z[M++]=it+b,Z[M++]=it+b+1,Z[M++]=at+b+1,Z[M++]=it+b,Z[M++]=at+b+1,Z[M++]=at+b;if(z){var mt=L*O;for(h=1;h<L-2;h++)for(at=mt+h*O,it=mt+(h+1)*O,b=1;b<O-2;b++)Z[M++]=it+b,Z[M++]=at+b,Z[M++]=at+b+1,Z[M++]=it+b,Z[M++]=at+b+1,Z[M++]=it+b+1}if(z){if(N)for(nt=L*O,h=1;h<O-2;h++)Z[M++]=h,Z[M++]=h+1,Z[M++]=nt+h+1,Z[M++]=h,Z[M++]=nt+h+1,Z[M++]=nt+h;if(R)for(rt=L*O-O,nt=L*O*E-O,h=1;h<O-2;h++)Z[M++]=rt+h+1,Z[M++]=rt+h,Z[M++]=nt+h,Z[M++]=rt+h+1,Z[M++]=nt+h,Z[M++]=nt+h+1}if(U){for(h=1;h<L-2;h++)nt=O*L+O*h,rt=O*h,Z[M++]=nt,Z[M++]=rt+O,Z[M++]=rt,Z[M++]=nt,Z[M++]=nt+O,Z[M++]=rt+O;for(h=1;h<L-2;h++)nt=O*L+O*(h+1)-1,rt=O*(h+1)-1,Z[M++]=rt+O,Z[M++]=nt,Z[M++]=rt,Z[M++]=rt+O,Z[M++]=nt+O,Z[M++]=nt}var st=new l.GeometryAttributes;g.position&&(st.position=new s.GeometryAttribute({componentDatatype:m.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:B}));var ut,lt=0,ft=0,ct=0,dt=0,Ct=S/2,pt=r.Ellipsoid.fromCartesian3(a),yt=r.Ellipsoid.fromCartesian3(d);if(g.st||g.normal||g.tangent||g.bitangent){for(h=0;h<S;h++){ut=W[h]?yt:pt;var _t=i.Cartesian3.fromArray(B,3*h,C),vt=ut.geodeticSurfaceNormal(_t,p);if(Y[h]&&i.Cartesian3.negate(vt,vt),g.st){var ht=o.Cartesian2.negate(vt,v);K[lt++]=Math.atan2(ht.y,ht.x)/i.CesiumMath.TWO_PI+.5,K[lt++]=Math.asin(vt.z)/Math.PI+.5}if(g.normal&&(j[ft++]=vt.x,j[ft++]=vt.y,j[ft++]=vt.z),g.tangent||g.bitangent){var At,xt=y,bt=0;if(W[h]&&(bt=Ct),At=!N&&h>=bt&&h<bt+2*O?i.Cartesian3.UNIT_X:i.Cartesian3.UNIT_Z,i.Cartesian3.cross(At,vt,xt),i.Cartesian3.normalize(xt,xt),g.tangent&&(q[ct++]=xt.x,q[ct++]=xt.y,q[ct++]=xt.z),g.bitangent){var kt=i.Cartesian3.cross(vt,xt,_);i.Cartesian3.normalize(kt,kt),H[dt++]=kt.x,H[dt++]=kt.y,H[dt++]=kt.z}}}g.st&&(st.st=new s.GeometryAttribute({componentDatatype:m.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:K})),g.normal&&(st.normal=new s.GeometryAttribute({componentDatatype:m.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j})),g.tangent&&(st.tangent=new s.GeometryAttribute({componentDatatype:m.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:q})),g.bitangent&&(st.bitangent=new s.GeometryAttribute({componentDatatype:m.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:H}))}if(e.defined(t._offsetAttribute)){var wt=B.length,Ft=new Uint8Array(wt/3),Pt=t._offsetAttribute===c.GeometryOffsetAttribute.NONE?0:1;c.arrayFill(Ft,Pt),st.applyOffset=new s.GeometryAttribute({componentDatatype:m.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:Ft})}return new s.Geometry({attributes:st,indices:Z,primitiveType:u.PrimitiveType.TRIANGLES,boundingSphere:n.BoundingSphere.fromEllipsoid(pt),offsetAttribute:t._offsetAttribute})}}},b.getUnitEllipsoid=function(){return e.defined(k)||(k=b.createGeometry(new b({radii:new i.Cartesian3(1,1,1),vertexFormat:d.VertexFormat.POSITION_ONLY}))),k},t.EllipsoidGeometry=b}));

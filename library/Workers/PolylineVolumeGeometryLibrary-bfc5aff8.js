define(["exports","./Math-85667bf9","./Cartesian3-2a8ef78e","./Ellipsoid-367a1bb3","./Transforms-2448ecca","./Cartesian2-dcadeea9","./EllipsoidTangentPlane-d61c0913","./PolylinePipeline-b196c43f"],(function(a,e,r,n,t,i,s,o){"use strict";var l=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),C=[new r.Cartesian3,new r.Cartesian3],c=new r.Cartesian3,u=new r.Cartesian3,y=new r.Cartesian3,d=new r.Cartesian3,m=new r.Cartesian3,f=new r.Cartesian3,p=new r.Cartesian3,g=new r.Cartesian3,w=new r.Cartesian3,h=new r.Cartesian3,v=new r.Cartesian3,x={},P=new n.Cartographic;function E(a,e,n,t){var i,s=a[0],o=a[1],l=r.Cartesian3.angleBetween(s,o),C=Math.ceil(l/t),c=new Array(C);if(e===n){for(i=0;i<C;i++)c[i]=e;return c.push(n),c}var u=(n-e)/C;for(i=1;i<C;i++){var y=e+i*u;c[i]=y}return c[0]=e,c.push(n),c}var M=new r.Cartesian3,T=new r.Cartesian3;var B=new r.Cartesian3(-1,0,0),b=new t.Matrix4,z=new t.Matrix4,S=new t.Matrix3,A=t.Matrix3.IDENTITY.clone(),D=new r.Cartesian3,O=new t.Cartesian4,N=new r.Cartesian3;function V(a,e,n,o,l,C,c,u){var y=D,d=O;b=t.Transforms.eastNorthUpToFixedFrame(a,l,b),y=t.Matrix4.multiplyByPointAsVector(b,B,y);var m=function(a,e,n,t){var o=new s.EllipsoidTangentPlane(n,t),l=o.projectPointOntoPlane(r.Cartesian3.add(n,a,M),M),C=o.projectPointOntoPlane(r.Cartesian3.add(n,e,T),T),c=i.Cartesian2.angleBetween(l,C);return C.x*l.y-C.y*l.x>=0?-c:c}(y=r.Cartesian3.normalize(y,y),e,a,l);S=t.Matrix3.fromRotationZ(m,S),N.z=C,b=t.Matrix4.multiplyTransformation(b,t.Matrix4.fromRotationTranslation(S,N,z),b);var f=A;f[0]=c;for(var p=0;p<u;p++)for(var g=0;g<n.length;g+=3)d=r.Cartesian3.fromArray(n,g,d),d=t.Matrix3.multiplyByVector(f,d,d),d=t.Matrix4.multiplyByPoint(b,d,d),o.push(d.x,d.y,d.z);return o}var G=new r.Cartesian3;function R(a,e,n,t,i,s,o){for(var l=0;l<a.length;l+=3){t=V(r.Cartesian3.fromArray(a,l,G),e,n,t,i,s[l/3],o,1)}return t}function I(a,e){for(var r=a.length,n=new Array(3*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=0;o<r;o++)n[t++]=a[o].x-i,n[t++]=0,n[t++]=a[o].y-s;return n}var L=new t.Quaternion,j=new r.Cartesian3,Q=new t.Matrix3;function F(a,n,i,s,o,C,c,u,y,d){var m,f,p=r.Cartesian3.angleBetween(r.Cartesian3.subtract(n,a,h),r.Cartesian3.subtract(i,a,v)),g=s===l.BEVELED?0:Math.ceil(p/e.CesiumMath.toRadians(5));if(m=o?t.Matrix3.fromQuaternion(t.Quaternion.fromAxisAngle(r.Cartesian3.negate(a,h),p/(g+1),L),Q):t.Matrix3.fromQuaternion(t.Quaternion.fromAxisAngle(a,p/(g+1),L),Q),n=r.Cartesian3.clone(n,j),g>0)for(var w=d?2:1,x=0;x<g;x++)n=t.Matrix3.multiplyByVector(m,n,n),f=r.Cartesian3.subtract(n,a,h),f=r.Cartesian3.normalize(f,f),o||(f=r.Cartesian3.negate(f,f)),c=V(C.scaleToGeodeticSurface(n,v),f,u,c,C,y,1,w);else f=r.Cartesian3.subtract(n,a,h),f=r.Cartesian3.normalize(f,f),o||(f=r.Cartesian3.negate(f,f)),c=V(C.scaleToGeodeticSurface(n,v),f,u,c,C,y,1,1),i=r.Cartesian3.clone(i,j),f=r.Cartesian3.subtract(i,a,h),f=r.Cartesian3.normalize(f,f),o||(f=r.Cartesian3.negate(f,f)),c=V(C.scaleToGeodeticSurface(i,v),f,u,c,C,y,1,1);return c}x.removeDuplicatesFromShape=function(a){for(var e=a.length,r=[],n=e-1,t=0;t<e;n=t++){var s=a[n],o=a[t];i.Cartesian2.equals(s,o)||r.push(o)}return r},x.angleIsGreaterThanPi=function(a,e,n,t){var i=new s.EllipsoidTangentPlane(n,t),o=i.projectPointOntoPlane(r.Cartesian3.add(n,a,M),M),l=i.projectPointOntoPlane(r.Cartesian3.add(n,e,T),T);return l.x*o.y-l.y*o.x>=0};var U=new r.Cartesian3,_=new r.Cartesian3;x.computePositions=function(a,n,t,i,s){var v=i._ellipsoid,M=function(a,e){for(var r=new Array(a.length),n=0;n<a.length;n++){var t=a[n];P=e.cartesianToCartographic(t,P),r[n]=P.height,a[n]=e.scaleToGeodeticSurface(t,t)}return r}(a,v),T=i._granularity,B=i._cornerType,b=s?function(a,e){var r=a.length,n=new Array(6*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=a[0];n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s;for(var l=1;l<r;l++){var C=(o=a[l]).x-i,c=o.y-s;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return o=a[0],n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s,n}(n,t):I(n,t),z=s?I(n,t):void 0,S=t.height/2,A=t.width/2,D=a.length,O=[],N=s?[]:void 0,G=c,L=u,j=y,Q=d,q=m,Y=f,Z=p,k=g,H=w,J=a[0],K=a[1];Q=v.geodeticSurfaceNormal(J,Q),G=r.Cartesian3.subtract(K,J,G),G=r.Cartesian3.normalize(G,G),k=r.Cartesian3.cross(Q,G,k),k=r.Cartesian3.normalize(k,k);var W,X=M[0],$=M[1];s&&(N=V(J,k,z,N,v,X+S,1,1)),H=r.Cartesian3.clone(J,H),J=K,L=r.Cartesian3.negate(G,L);for(var aa=1;aa<D-1;aa++){var ea=s?2:1;K=a[aa+1],G=r.Cartesian3.subtract(K,J,G),G=r.Cartesian3.normalize(G,G),j=r.Cartesian3.add(G,L,j),j=r.Cartesian3.normalize(j,j),Q=v.geodeticSurfaceNormal(J,Q);var ra=r.Cartesian3.multiplyByScalar(Q,r.Cartesian3.dot(G,Q),U);r.Cartesian3.subtract(G,ra,ra),r.Cartesian3.normalize(ra,ra);var na=r.Cartesian3.multiplyByScalar(Q,r.Cartesian3.dot(L,Q),_);if(r.Cartesian3.subtract(L,na,na),r.Cartesian3.normalize(na,na),!e.CesiumMath.equalsEpsilon(Math.abs(r.Cartesian3.dot(ra,na)),1,e.CesiumMath.EPSILON7)){j=r.Cartesian3.cross(j,Q,j),j=r.Cartesian3.cross(Q,j,j),j=r.Cartesian3.normalize(j,j);var ta=1/Math.max(.25,r.Cartesian3.magnitude(r.Cartesian3.cross(j,L,h))),ia=x.angleIsGreaterThanPi(G,L,J,v);ia?(q=r.Cartesian3.add(J,r.Cartesian3.multiplyByScalar(j,ta*A,j),q),Y=r.Cartesian3.add(q,r.Cartesian3.multiplyByScalar(k,A,Y),Y),C[0]=r.Cartesian3.clone(H,C[0]),C[1]=r.Cartesian3.clone(Y,C[1]),W=E(C,X+S,$+S,T),O=R(o.PolylinePipeline.generateArc({positions:C,granularity:T,ellipsoid:v}),k,b,O,v,W,1),k=r.Cartesian3.cross(Q,G,k),k=r.Cartesian3.normalize(k,k),Z=r.Cartesian3.add(q,r.Cartesian3.multiplyByScalar(k,A,Z),Z),B===l.ROUNDED||B===l.BEVELED?F(q,Y,Z,B,ia,v,O,b,$+S,s):O=V(J,j=r.Cartesian3.negate(j,j),b,O,v,$+S,ta,ea),H=r.Cartesian3.clone(Z,H)):(q=r.Cartesian3.add(J,r.Cartesian3.multiplyByScalar(j,ta*A,j),q),Y=r.Cartesian3.add(q,r.Cartesian3.multiplyByScalar(k,-A,Y),Y),C[0]=r.Cartesian3.clone(H,C[0]),C[1]=r.Cartesian3.clone(Y,C[1]),W=E(C,X+S,$+S,T),O=R(o.PolylinePipeline.generateArc({positions:C,granularity:T,ellipsoid:v}),k,b,O,v,W,1),k=r.Cartesian3.cross(Q,G,k),k=r.Cartesian3.normalize(k,k),Z=r.Cartesian3.add(q,r.Cartesian3.multiplyByScalar(k,-A,Z),Z),B===l.ROUNDED||B===l.BEVELED?F(q,Y,Z,B,ia,v,O,b,$+S,s):O=V(J,j,b,O,v,$+S,ta,ea),H=r.Cartesian3.clone(Z,H)),L=r.Cartesian3.negate(G,L)}else O=V(H,k,b,O,v,X+S,1,1),H=J;X=$,$=M[aa+1],J=K}C[0]=r.Cartesian3.clone(H,C[0]),C[1]=r.Cartesian3.clone(J,C[1]),W=E(C,X+S,$+S,T),O=R(o.PolylinePipeline.generateArc({positions:C,granularity:T,ellipsoid:v}),k,b,O,v,W,1),s&&(N=V(J,k,z,N,v,$+S,1,1)),D=O.length;var sa=s?D+N.length:D,oa=new Float64Array(sa);return oa.set(O),s&&oa.set(N,D),oa},a.CornerType=l,a.PolylineVolumeGeometryLibrary=x}));
//# sourceMappingURL=PolylineVolumeGeometryLibrary-bfc5aff8.js.map

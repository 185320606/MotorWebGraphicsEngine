define(["exports","./when-7ef6387a","./Check-ed6a1804","./Math-85667bf9","./Cartesian3-2a8ef78e","./Ellipsoid-367a1bb3","./Transforms-2448ecca","./IntersectionTests-1ea321e8","./Plane-15b63a5b","./EllipsoidRhumbLine-9bce4c37","./EllipsoidGeodesic-38ad6cf2"],(function(a,e,r,i,t,n,o,s,c,l,u){"use strict";var h={numberOfPoints:function(a,e,r){var i=t.Cartesian3.distance(a,e);return Math.ceil(i/r)},numberOfPointsRhumbLine:function(a,e,r){var i=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.ceil(Math.sqrt(i/(r*r)))}},f=new n.Cartographic;h.extractHeights=function(a,e){for(var r=a.length,i=new Array(r),t=0;t<r;t++){var n=a[t];i[t]=e.cartesianToCartographic(n,f).height}return i};var p=new o.Matrix4,d=new t.Cartesian3,C=new t.Cartesian3,g=new c.Plane(t.Cartesian3.UNIT_X,0),v=new t.Cartesian3,m=new c.Plane(t.Cartesian3.UNIT_X,0),w=new t.Cartesian3,T=new t.Cartesian3,P=[];function y(a,e,r){var i,t=P;if(t.length=a,e===r){for(i=0;i<a;i++)t[i]=e;return t}var n=(r-e)/a;for(i=0;i<a;i++){var o=e+i*n;t[i]=o}return t}var E=new n.Cartographic,b=new n.Cartographic,A=new t.Cartesian3,S=new t.Cartesian3,R=new t.Cartesian3,D=new u.EllipsoidGeodesic,M=new l.EllipsoidRhumbLine;function G(a,e,r,i,n,o,s,c){var l=i.scaleToGeodeticSurface(a,S),u=i.scaleToGeodeticSurface(e,R),f=h.numberOfPoints(a,e,r),p=i.cartesianToCartographic(l,E),d=i.cartesianToCartographic(u,b),C=y(f,n,o);D.setEndPoints(p,d);var g=D.surfaceDistance/f,v=c;p.height=n;var m=i.cartographicToCartesian(p,A);t.Cartesian3.pack(m,s,v),v+=3;for(var w=1;w<f;w++){var T=D.interpolateUsingSurfaceDistance(w*g,b);T.height=C[w],m=i.cartographicToCartesian(T,A),t.Cartesian3.pack(m,s,v),v+=3}return v}function x(a,e,r,i,n,o,s,c){var u=i.scaleToGeodeticSurface(a,S),f=i.scaleToGeodeticSurface(e,R),p=i.cartesianToCartographic(u,E),d=i.cartesianToCartographic(f,b),C=h.numberOfPointsRhumbLine(p,d,r),g=y(C,n,o);M.ellipsoid.equals(i)||(M=new l.EllipsoidRhumbLine(void 0,void 0,i)),M.setEndPoints(p,d);var v=M.surfaceDistance/C,m=c;p.height=n;var w=i.cartographicToCartesian(p,A);t.Cartesian3.pack(w,s,m),m+=3;for(var T=1;T<C;T++){var P=M.interpolateUsingSurfaceDistance(T*v,b);P.height=g[T],w=i.cartographicToCartesian(P,A),t.Cartesian3.pack(w,s,m),m+=3}return m}h.wrapLongitude=function(a,r){var i=[],n=[];if(e.defined(a)&&a.length>0){r=e.defaultValue(r,o.Matrix4.IDENTITY);var l=o.Matrix4.inverseTransformation(r,p),u=o.Matrix4.multiplyByPoint(l,t.Cartesian3.ZERO,d),h=t.Cartesian3.normalize(o.Matrix4.multiplyByPointAsVector(l,t.Cartesian3.UNIT_Y,C),C),f=c.Plane.fromPointNormal(u,h,g),P=t.Cartesian3.normalize(o.Matrix4.multiplyByPointAsVector(l,t.Cartesian3.UNIT_X,v),v),y=c.Plane.fromPointNormal(u,P,m),E=1;i.push(t.Cartesian3.clone(a[0]));for(var b=i[0],A=a.length,S=1;S<A;++S){var R=a[S];if(c.Plane.getPointDistance(y,b)<0||c.Plane.getPointDistance(y,R)<0){var D=s.IntersectionTests.lineSegmentPlane(b,R,f,w);if(e.defined(D)){var M=t.Cartesian3.multiplyByScalar(h,5e-9,T);c.Plane.getPointDistance(f,b)<0&&t.Cartesian3.negate(M,M),i.push(t.Cartesian3.add(D,M,new t.Cartesian3)),n.push(E+1),t.Cartesian3.negate(M,M),i.push(t.Cartesian3.add(D,M,new t.Cartesian3)),E=1}}i.push(t.Cartesian3.clone(a[S])),E++,b=R}n.push(E)}return{positions:i,lengths:n}},h.generateArc=function(a){e.defined(a)||(a={});var o=a.positions;if(!e.defined(o))throw new r.DeveloperError("options.positions is required.");var s=o.length,c=e.defaultValue(a.ellipsoid,n.Ellipsoid.WGS84),l=e.defaultValue(a.height,0),u=Array.isArray(l);if(s<1)return[];if(1===s){var f=c.scaleToGeodeticSurface(o[0],S);if(0!==(l=u?l[0]:l)){var p=c.geodeticSurfaceNormal(f,A);t.Cartesian3.multiplyByScalar(p,l,p),t.Cartesian3.add(f,p,f)}return[f.x,f.y,f.z]}var d=a.minDistance;if(!e.defined(d)){var C=e.defaultValue(a.granularity,i.CesiumMath.RADIANS_PER_DEGREE);d=i.CesiumMath.chordLength(C,c.maximumRadius)}var g,v=0;for(g=0;g<s-1;g++)v+=h.numberOfPoints(o[g],o[g+1],d);var m=3*(v+1),w=new Array(m),T=0;for(g=0;g<s-1;g++){T=G(o[g],o[g+1],d,c,u?l[g]:l,u?l[g+1]:l,w,T)}P.length=0;var y=o[s-1],b=c.cartesianToCartographic(y,E);b.height=u?l[s-1]:l;var R=c.cartographicToCartesian(b,A);return t.Cartesian3.pack(R,w,m-3),w};var N=new n.Cartographic,I=new n.Cartographic;h.generateRhumbArc=function(a){e.defined(a)||(a={});var o=a.positions;if(!e.defined(o))throw new r.DeveloperError("options.positions is required.");var s=o.length,c=e.defaultValue(a.ellipsoid,n.Ellipsoid.WGS84),l=e.defaultValue(a.height,0),u=Array.isArray(l);if(s<1)return[];if(1===s){var f=c.scaleToGeodeticSurface(o[0],S);if(0!==(l=u?l[0]:l)){var p=c.geodeticSurfaceNormal(f,A);t.Cartesian3.multiplyByScalar(p,l,p),t.Cartesian3.add(f,p,f)}return[f.x,f.y,f.z]}var d,C,g=e.defaultValue(a.granularity,i.CesiumMath.RADIANS_PER_DEGREE),v=0,m=c.cartesianToCartographic(o[0],N);for(d=0;d<s-1;d++)C=c.cartesianToCartographic(o[d+1],I),v+=h.numberOfPointsRhumbLine(m,C,g),m=n.Cartographic.clone(C,N);var w=3*(v+1),T=new Array(w),y=0;for(d=0;d<s-1;d++){y=x(o[d],o[d+1],g,c,u?l[d]:l,u?l[d+1]:l,T,y)}P.length=0;var b=o[s-1],R=c.cartesianToCartographic(b,E);R.height=u?l[s-1]:l;var D=c.cartographicToCartesian(R,A);return t.Cartesian3.pack(D,T,w-3),T},h.generateCartesianArc=function(a){for(var e=h.generateArc(a),r=e.length/3,i=new Array(r),n=0;n<r;n++)i[n]=t.Cartesian3.unpack(e,3*n);return i},h.generateCartesianRhumbArc=function(a){for(var e=h.generateRhumbArc(a),r=e.length/3,i=new Array(r),n=0;n<r;n++)i[n]=t.Cartesian3.unpack(e,3*n);return i},a.PolylinePipeline=h}));
//# sourceMappingURL=PolylinePipeline-b196c43f.js.map

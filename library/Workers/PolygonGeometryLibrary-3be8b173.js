define(["exports","./when-7ef6387a","./Math-85667bf9","./Cartesian3-2a8ef78e","./Ellipsoid-367a1bb3","./Transforms-2448ecca","./Cartesian2-dcadeea9","./ComponentDatatype-a863af81","./GeometryAttribute-a3332dc3","./PrimitiveType-4c1d698a","./GeometryAttributes-cb18da36","./GeometryPipeline-b6bb8671","./IndexDatatype-f12d39b5","./arrayRemoveDuplicates-9458abce","./ArcType-2ee8dfbb","./EllipsoidRhumbLine-9bce4c37","./PolygonPipeline-374effa4"],(function(e,t,r,i,a,n,o,s,u,l,h,c,f,p,d,y,g){"use strict";function v(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(v.prototype,{length:{get:function(){return this._length}}}),v.prototype.enqueue=function(e){this._array.push(e),this._length++},v.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},v.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},v.prototype.contains=function(e){return-1!==this._array.indexOf(e)},v.prototype.clear=function(){this._array.length=this._offset=this._length=0},v.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var m={computeHierarchyPackedLength:function(e){for(var r=0,a=[e];a.length>0;){var n=a.pop();if(t.defined(n)){r+=2;var o=n.positions,s=n.holes;if(t.defined(o)&&(r+=o.length*i.Cartesian3.packedLength),t.defined(s))for(var u=s.length,l=0;l<u;++l)a.push(s[l])}}return r},packPolygonHierarchy:function(e,r,a){for(var n=[e];n.length>0;){var o=n.pop();if(t.defined(o)){var s=o.positions,u=o.holes;if(r[a++]=t.defined(s)?s.length:0,r[a++]=t.defined(u)?u.length:0,t.defined(s))for(var l=s.length,h=0;h<l;++h,a+=3)i.Cartesian3.pack(s[h],r,a);if(t.defined(u))for(var c=u.length,f=0;f<c;++f)n.push(u[f])}}return a},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],a=e[t++],n=new Array(r),o=a>0?new Array(a):void 0,s=0;s<r;++s,t+=i.Cartesian3.packedLength)n[s]=i.Cartesian3.unpack(e,t);for(var u=0;u<a;++u)o[u]=m.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:n,holes:o,startingIndex:t}}},C=new i.Cartesian3;function b(e,t,r,a){return i.Cartesian3.subtract(t,e,C),i.Cartesian3.multiplyByScalar(C,r/a,C),i.Cartesian3.add(e,C,C),[C.x,C.y,C.z]}m.subdivideLineCount=function(e,t,a){var n=i.Cartesian3.distance(e,t)/a,o=Math.max(0,Math.ceil(r.CesiumMath.log2(n)));return Math.pow(2,o)};var T=new a.Cartographic,w=new a.Cartographic,I=new a.Cartographic,E=new i.Cartesian3;m.subdivideRhumbLineCount=function(e,t,i,a){var n=e.cartesianToCartographic(t,T),o=e.cartesianToCartographic(i,w),s=new y.EllipsoidRhumbLine(n,o,e).surfaceDistance/a,u=Math.max(0,Math.ceil(r.CesiumMath.log2(s)));return Math.pow(2,u)},m.subdivideLine=function(e,r,a,n){var o=m.subdivideLineCount(e,r,a),s=i.Cartesian3.distance(e,r),u=s/o;t.defined(n)||(n=[]);var l=n;l.length=3*o;for(var h=0,c=0;c<o;c++){var f=b(e,r,c*u,s);l[h++]=f[0],l[h++]=f[1],l[h++]=f[2]}return l},m.subdivideRhumbLine=function(e,i,a,n,o){var s=e.cartesianToCartographic(i,T),u=e.cartesianToCartographic(a,w),l=new y.EllipsoidRhumbLine(s,u,e),h=l.surfaceDistance/n,c=Math.max(0,Math.ceil(r.CesiumMath.log2(h))),f=Math.pow(2,c),p=l.surfaceDistance/f;t.defined(o)||(o=[]);var d=o;d.length=3*f;for(var g=0,v=0;v<f;v++){var m=l.interpolateUsingSurfaceDistance(v*p,I),C=e.cartographicToCartesian(m,E);d[g++]=C.x,d[g++]=C.y,d[g++]=C.z}return d};var x=new i.Cartesian3,P=new i.Cartesian3,A=new i.Cartesian3,_=new i.Cartesian3;m.scaleToGeodeticHeightExtruded=function(e,r,n,o,s){o=t.defaultValue(o,a.Ellipsoid.WGS84);var u=x,l=P,h=A,c=_;if(t.defined(e)&&t.defined(e.attributes)&&t.defined(e.attributes.position))for(var f=e.attributes.position.values,p=f.length/2,d=0;d<p;d+=3)i.Cartesian3.fromArray(f,d,h),o.geodeticSurfaceNormal(h,u),c=o.scaleToGeodeticSurface(h,c),l=i.Cartesian3.multiplyByScalar(u,n,l),l=i.Cartesian3.add(c,l,l),f[d+p]=l.x,f[d+1+p]=l.y,f[d+2+p]=l.z,s&&(c=i.Cartesian3.clone(h,c)),l=i.Cartesian3.multiplyByScalar(u,r,l),l=i.Cartesian3.add(c,l,l),f[d]=l.x,f[d+1]=l.y,f[d+2]=l.z;return e},m.polygonOutlinesFromHierarchy=function(e,r,a){var n,o,s,u=[],l=new v;for(l.enqueue(e);0!==l.length;){var h=l.dequeue(),c=h.positions;if(r)for(s=c.length,n=0;n<s;n++)a.scaleToGeodeticSurface(c[n],c[n]);if(!((c=p.arrayRemoveDuplicates(c,i.Cartesian3.equalsEpsilon,!0)).length<3)){var f=h.holes?h.holes.length:0;for(n=0;n<f;n++){var d=h.holes[n],y=d.positions;if(r)for(s=y.length,o=0;o<s;++o)a.scaleToGeodeticSurface(y[o],y[o]);if(!((y=p.arrayRemoveDuplicates(y,i.Cartesian3.equalsEpsilon,!0)).length<3)){u.push(y);var g=0;for(t.defined(d.holes)&&(g=d.holes.length),o=0;o<g;o++)l.enqueue(d.holes[o])}}u.push(c)}}return u},m.polygonsFromHierarchy=function(e,r,a,n){var o=[],s=[],u=new v;for(u.enqueue(e);0!==u.length;){var l,h,c=u.dequeue(),f=c.positions,d=c.holes;if(a)for(h=f.length,l=0;l<h;l++)n.scaleToGeodeticSurface(f[l],f[l]);if(!((f=p.arrayRemoveDuplicates(f,i.Cartesian3.equalsEpsilon,!0)).length<3)){var y=r(f);if(t.defined(y)){var m=[],C=g.PolygonPipeline.computeWindingOrder2D(y);C===g.WindingOrder.CLOCKWISE&&(y.reverse(),f=f.slice().reverse());var b,T=f.slice(),w=t.defined(d)?d.length:0,I=[];for(l=0;l<w;l++){var E=d[l],x=E.positions;if(a)for(h=x.length,b=0;b<h;++b)n.scaleToGeodeticSurface(x[b],x[b]);if(!((x=p.arrayRemoveDuplicates(x,i.Cartesian3.equalsEpsilon,!0)).length<3)){var P=r(x);if(t.defined(P)){(C=g.PolygonPipeline.computeWindingOrder2D(P))===g.WindingOrder.CLOCKWISE&&(P.reverse(),x=x.slice().reverse()),I.push(x),m.push(T.length),T=T.concat(x),y=y.concat(P);var A=0;for(t.defined(E.holes)&&(A=E.holes.length),b=0;b<A;b++)u.enqueue(E.holes[b])}}}o.push({outerRing:f,holes:I}),s.push({positions:T,positions2D:y,holes:m})}}}return{hierarchy:o,polygons:s}};var G=new o.Cartesian2,L=new i.Cartesian3,M=new n.Quaternion,D=new n.Matrix3;m.computeBoundingRectangle=function(e,r,a,o,s){for(var u=n.Quaternion.fromAxisAngle(e,o,M),l=n.Matrix3.fromQuaternion(u,D),h=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,d=a.length,y=0;y<d;++y){var g=i.Cartesian3.clone(a[y],L);n.Matrix3.multiplyByVector(l,g,g);var v=r(g,G);t.defined(v)&&(h=Math.min(h,v.x),c=Math.max(c,v.x),f=Math.min(f,v.y),p=Math.max(p,v.y))}return s.x=h,s.y=f,s.width=c-h,s.height=p-f,s},m.createGeometryFromPositions=function(e,t,r,i,a,n){var o=g.PolygonPipeline.triangulate(t.positions2D,t.holes);o.length<3&&(o=[0,1,2]);var h=t.positions;if(i){for(var f=h.length,p=new Array(3*f),y=0,v=0;v<f;v++){var m=h[v];p[y++]=m.x,p[y++]=m.y,p[y++]=m.z}var C=new u.Geometry({attributes:{position:new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p})},indices:o,primitiveType:l.PrimitiveType.TRIANGLES});return a.normal?c.GeometryPipeline.computeNormal(C):C}return n===d.ArcType.GEODESIC?g.PolygonPipeline.computeSubdivision(e,h,o,r):n===d.ArcType.RHUMB?g.PolygonPipeline.computeRhumbLineSubdivision(e,h,o,r):void 0};var S=[],R=new i.Cartesian3,N=new i.Cartesian3;m.computeWallGeometry=function(e,t,a,n,o){var c,p,y,g,v,C=e.length,b=0;if(n)for(p=3*C*2,c=new Array(2*p),y=0;y<C;y++)g=e[y],v=e[(y+1)%C],c[b]=c[b+p]=g.x,c[++b]=c[b+p]=g.y,c[++b]=c[b+p]=g.z,c[++b]=c[b+p]=v.x,c[++b]=c[b+p]=v.y,c[++b]=c[b+p]=v.z,++b;else{var T=r.CesiumMath.chordLength(a,t.maximumRadius),w=0;if(o===d.ArcType.GEODESIC)for(y=0;y<C;y++)w+=m.subdivideLineCount(e[y],e[(y+1)%C],T);else if(o===d.ArcType.RHUMB)for(y=0;y<C;y++)w+=m.subdivideRhumbLineCount(t,e[y],e[(y+1)%C],T);for(p=3*(w+C),c=new Array(2*p),y=0;y<C;y++){var I;g=e[y],v=e[(y+1)%C],o===d.ArcType.GEODESIC?I=m.subdivideLine(g,v,T,S):o===d.ArcType.RHUMB&&(I=m.subdivideRhumbLine(t,g,v,T,S));for(var E=I.length,x=0;x<E;++x,++b)c[b]=I[x],c[b+p]=I[x];c[b]=v.x,c[b+p]=v.x,c[++b]=v.y,c[b+p]=v.y,c[++b]=v.z,c[b+p]=v.z,++b}}C=c.length;var P=f.IndexDatatype.createTypedArray(C/3,C-6*e.length),A=0;for(C/=6,y=0;y<C;y++){var _=y,G=_+1,L=_+C,M=L+1;g=i.Cartesian3.fromArray(c,3*_,R),v=i.Cartesian3.fromArray(c,3*G,N),i.Cartesian3.equalsEpsilon(g,v,r.CesiumMath.EPSILON10,r.CesiumMath.EPSILON10)||(P[A++]=_,P[A++]=L,P[A++]=G,P[A++]=G,P[A++]=L,P[A++]=M)}return new u.Geometry({attributes:new h.GeometryAttributes({position:new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:c})}),indices:P,primitiveType:l.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=m}));
//# sourceMappingURL=PolygonGeometryLibrary-3be8b173.js.map
